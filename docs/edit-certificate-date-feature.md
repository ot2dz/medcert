# ميزة تعديل تاريخ إصدار الشهادة

## نظرة عامة
تم إضافة ميزة جديدة تتيح للمستخدمين تعديل تاريخ إصدار الشهادة (issue_date) لكل شهادة طبية من قسم إدارة المرضى.

## كيفية الاستخدام

### 1. الوصول للميزة
- انتقل إلى تبويب "إدارة المرضى"
- اختر مريضاً من القائمة الجانبية
- في قسم "الشهادات الطبية"، ستجد زر "✏️" بجانب تاريخ إصدار كل شهادة

### 2. تعديل تاريخ الإصدار
- اضغط على زر "✏️" الأخضر بجانب تاريخ الإصدار
- سيظهر حقل إدخال التاريخ مع أزرار (✓ حفظ / ✗ إلغاء)
- اختر التاريخ الجديد المطلوب
- اضغط "✓" للحفظ أو "✗" للإلغاء

### 3. التأكيد والحفظ
- ستظهر رسالة تأكيد تعرض:
  - رقم الشهادة
  - التاريخ القديم والجديد
  - تحذير حول تأثير التغيير على الشهادة المطبوعة
- بعد التأكيد، سيتم تحديث التاريخ في قاعدة البيانات
- ستظهر رسالة نجاح وسيتم تحديث العرض تلقائياً

## المميزات الفنية

### 1. الأمان والتحقق
- رسالة تأكيد مفصلة قبل أي تعديل
- عرض رقم الشهادة والتواريخ للمراجعة
- تحذير واضح حول تأثير التغيير على الطباعة
- إمكانية الإلغاء في أي مرحلة

### 2. تجربة المستخدم المحسّنة
- **زر تعديل أخضر صغير**: تصميم لطيف وغير مزعج
- **حقل تاريخ مدمج**: يظهر مكان النص الأصلي
- **أزرار صغيرة للحفظ/الإلغاء**: تصميم مدمج وعملي
- **تحديث فوري**: العرض يتحدث مباشرة بعد النجاح
- **رسائل واضحة**: تأكيدات ونجاح وأخطاء مفهومة

### 3. التصميم المتجاوب
- يعمل على جميع أحجام الشاشات
- تخطيط متكيف للشاشات الصغيرة
- أزرار وحقول مناسبة للمس

### 4. التوافق والأداء
- تعمل مع جميع الشهادات الموجودة
- تحديث محلي سريع للواجهة
- لا تحتاج إعادة تحميل الصفحة
- الأرقام تظهر بالتنسيق الغربي

## التحديثات التقنية

### 1. قاعدة البيانات (database.js)
```javascript
function updateCertificateIssueDate(certificateId, issueDate) {
    const stmt = db.prepare('UPDATE certificates SET issue_date = ? WHERE id = ?');
    const info = stmt.run(issueDate, certificateId);
    return info.changes > 0;
}
```

### 2. الخادم الرئيسي (main.js)
- إضافة IPC handler: `db:updateCertificateIssueDate`
- ربط آمن بقاعدة البيانات

### 3. واجهة المستخدم (PatientManagement.jsx)
```javascript
// State للتحكم في التعديل
const [editingCertificateDate, setEditingCertificateDate] = useState(null);
const [newCertificateDate, setNewCertificateDate] = useState('');

// دوال التعديل
- handleStartEditCertificateDate()
- handleUpdateCertificateDate() 
- handleCancelEditCertificateDate()
```

### 4. التصميم (PatientManagement.css)
```css
/* زر التعديل الأخضر */
.btn-edit-certificate-date {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    /* تأثيرات hover وscale جميلة */
}

/* حقل التاريخ المدمج */
.date-input-small {
    padding: 4px 8px;
    min-width: 120px;
    /* تنسيق لطيف ومدمج */
}

/* أزرار الحفظ والإلغاء */
.btn-save-small, .btn-cancel-small {
    width: 24px; height: 24px;
    /* تصميم صغير وأنيق */
}
```

## واجهة العرض

### عرض عادي:
```
شهادة #123                    03/10/2025 ✏️
```

### وضع التعديل:
```
شهادة #123    [📅 2025-10-05] [✓] [✗]
```

## أمثلة الاستخدام

### 1. تصحيح تاريخ خاطئ
- شهادة صدرت بتاريخ خاطئ
- تعديل التاريخ للتاريخ الصحيح
- إعادة طباعة الشهادة بالتاريخ المُحدث

### 2. تعديل للمتطلبات الإدارية
- تغيير تاريخ لمتطلبات تأمين معينة
- توافق مع مواعيد رسمية
- تعديلات لأغراض قانونية

### 3. إصلاح أخطاء الإدخال
- تاريخ مدخل بالخطأ
- تصحيح سريع وبسيط
- عدم الحاجة لحذف وإعادة إنشاء

## ملاحظات مهمة

### ⚠️ تحذيرات
- **تأثير على الطباعة**: تغيير التاريخ يؤثر على الشهادة المطبوعة
- **المسؤولية القانونية**: تأكد من قانونية تعديل التاريخ
- **التوثيق**: احتفظ بسجل للتعديلات إذا لزم الأمر

### 💡 نصائح للاستخدام الأمثل
- **راجع التاريخ جيداً** قبل التأكيد
- **استخدم للتصحيحات فقط** وليس التلاعب
- **أعد طباعة الشهادة** بعد التعديل إذا لزم الأمر
- **تأكد من التاريخ المنطقي** (لا يكون في المستقبل البعيد)

### 🔄 التأثير على النظام
- **تحديث فوري** في قاعدة البيانات
- **تحديث العرض** مباشرة
- **تأثير على PDF الجديد** المُولّد
- **لا يؤثر على الملفات الموجودة** (يجب إعادة إنشاءها)

## الميزات المستقبلية المحتملة
- **سجل التعديلات**: تتبع كل تغيير تم
- **صلاحيات التعديل**: تحديد من يمكنه التعديل  
- **تحديد نطاق زمني**: منع التعديل لتواريخ قديمة جداً
- **نسخ احتياطية**: حفظ نسخة من التاريخ الأصلي